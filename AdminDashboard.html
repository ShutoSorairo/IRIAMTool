<div class="card">
    <h3>ğŸ“‚ ã‚®ãƒ•ãƒˆJSONç®¡ç†</h3>
    <p>ç¾åœ¨ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€è¿½åŠ ã—ã¦æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã—ã¾ã™ã€‚</p>
    
    <div style="background:#f9f9f9; padding:15px; border-radius:8px;">
        <h4>â‘  æ–°è¦ã‚®ãƒ•ãƒˆå…¥åŠ›</h4>
        <input type="text" id="new-name" placeholder="åå‰" style="margin-bottom:5px;">
        <select id="new-cat" style="margin-bottom:5px;">
            <option value="ãƒã‚¿">ãƒã‚¿</option>
            <option value="å®šç•ª">å®šç•ª</option>
            </select>
        <input type="text" id="new-src" placeholder="ç”»åƒãƒ‘ã‚¹" style="width:100%;">
        <button onclick="addAndExport()" style="margin-top:10px; background:#2e7d32; color:white; padding:8px;">
            ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦JSONã‚’ä½œæˆ
        </button>
    </div>
    
    <br>
    
    <div style="display:none;" id="download-area">
        <h4>â‘¡ æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h4>
        <p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ <b>gifts.json</b> ã‚’ä¿å­˜ã—ã€ãƒ•ã‚©ãƒ«ãƒ€å†…ã®åŒåãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚</p>
        <a id="download-link" href="#" style="background:#d32f2f; color:white; padding:10px; text-decoration:none; border-radius:5px;">
            gifts.json ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </a>
    </div>
</div>

<script>
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ä¸Šã®æœ€æ–°JSONã‚’å–å¾—ã—ã¦ãŠã
    let currentGifts = [];
    
    window.onload = async function() {
        // æ—¢å­˜ã®loadStatus()å‘¼ã³å‡ºã—ç­‰ã¯ç¶­æŒ
        if(typeof loadStatus === 'function') loadStatus();

        try {
            const res = await fetch('gifts.json');
            if(res.ok) {
                currentGifts = await res.json();
                console.log("ç¾åœ¨ã®ã‚®ãƒ•ãƒˆæ•°:", currentGifts.length);
            }
        } catch(e) {
            console.error("JSONèª­ã¿è¾¼ã¿å¤±æ•—", e);
        }
    };

    function addAndExport() {
        const name = document.getElementById('new-name').value;
        const cat = document.getElementById('new-cat').value;
        const src = document.getElementById('new-src').value;

        if(!name || !src) {
            alert("åå‰ã¨ç”»åƒãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
        }

        // é…åˆ—ã«è¿½åŠ 
        currentGifts.push({
            name: name,
            category: cat,
            src: src
        });

        // JSONæ–‡å­—åˆ—ã«å¤‰æ›
        const jsonStr = JSON.stringify(currentGifts, null, 2); // è¦‹ã‚„ã™ãæ•´å½¢

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ
        const blob = new Blob([jsonStr], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        
        const link = document.getElementById('download-link');
        link.href = url;
        link.download = "gifts.json"; // ãƒ•ã‚¡ã‚¤ãƒ«åæŒ‡å®š

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        document.getElementById('download-area').style.display = 'block';
        
        alert("ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚\nä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ›´æ–°ã—ã¦ãã ã•ã„ã€‚");
    }
</script>
